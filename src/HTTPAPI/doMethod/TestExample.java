package HTTPAPI.doMethod;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.io.UnsupportedEncodingException;
import java.net.HttpURLConnection;
import java.net.URL;
import java.security.cert.X509Certificate;

import javax.net.ssl.HostnameVerifier;
import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLSession;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509TrustManager;

public class TestExample {
		public static void main(String[] args) throws UnsupportedEncodingException {
			TestExample test=new TestExample();
			test.b();
		}
		
		private static void trustAllHosts() {
	        TrustManager[] trustAllCerts = new TrustManager[] {
	        	new X509TrustManager(){
	        					public java.security.cert.X509Certificate[] getAcceptedIssuers() {
	        						return new java.security.cert.X509Certificate[] {};
	        					}

	            public void checkClientTrusted(X509Certificate[] chain, String authType) {}

	            public void checkServerTrusted(X509Certificate[] chain, String authType) {}
	        }};
	        
	        try {
	            SSLContext sc = SSLContext.getInstance("TLS");
	            sc.init(null, trustAllCerts, new java.security.SecureRandom());
	            HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());
	        } catch (Exception e) {
	            e.printStackTrace();
	        }
	    }

	    private final static HostnameVerifier DO_NOT_VERIFY = new HostnameVerifier() {
	        public boolean verify(String hostname, SSLSession session) {
	            return true;
	        }
	    };
	    
		private void b()
		{
			
			/*
			curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{ \ 
			   "password": "admin", \ 
			   "username": "admin" \ 
			 }' 'https://66.42.65.86:8080/api/internal/login'
			 */
	        PrintWriter out = null;
	        BufferedReader in = null;
	        HttpURLConnection conn;
	        try {
	            trustAllHosts();
	            URL realUrl = new URL("https://66.42.65.86:8080/api/internal/login");
	            // 通过请求地址判断请求类型(http或者是https)
	            if (realUrl.getProtocol().toLowerCase().equals("https")) {
	                HttpsURLConnection https = (HttpsURLConnection) realUrl.openConnection();
	                https.setHostnameVerifier(DO_NOT_VERIFY);
	                        conn = https;
	            } else {
	                conn = (HttpURLConnection) realUrl.openConnection();
	            }
	            // 设置通用的请求属性
	            conn.setRequestProperty("accept", "application/json");
	            conn.setRequestProperty("connection", "application/json");
	            conn.setRequestProperty("Content-Type", "application/json;charset=utf-8");
	            // 发送POST请求必须设置如下两行
	            conn.setDoOutput(true);
	            conn.setDoInput(true);
	            // 获取URLConnection对象对应的输出流
	            out = new PrintWriter(conn.getOutputStream());
	            // 发送请求参数
	             out.print("{"
	             		+ "\"password\": \"admin\","
	             		+ " \"username\": \"admin\""
	             		+ "}");
	            // flush输出流的缓冲
	            out.flush();
	            // 定义BufferedReader输入流来读取URL的响应
	            in = new BufferedReader(new InputStreamReader(conn.getInputStream()));
	            String line;
	            while ((line = in.readLine()) != null) {
	                System.out.println(line);
	            }
	        } catch (Exception e) {
	            e.printStackTrace();
	        } finally {// 使用finally块来关闭输出流、输入流
	            try {
	                if (out != null) {
	    out.close();
	                }
	                if (in != null) {
	                    in.close();
	                }
	            } catch (IOException ex) {
	                ex.printStackTrace();
	            }
	        }
		}
}


